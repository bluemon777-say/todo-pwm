<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self';">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Î©îÎ™®</title>
  <style>
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Apple SD Gothic Neo, Noto Sans KR, sans-serif; }
    .wrap { padding: 16px; }
    h1 { margin: 0 0 12px; font-size: 20px; }
    .row { display: flex; gap: 8px; }
    textarea {
      flex: 1; height: 70px; resize: none; padding: 10px; border-radius: 10px;
      border: 1px solid #ddd; outline: none;
    }
    button {
      padding: 10px 12px; border: 0; border-radius: 10px; cursor: pointer;
      box-shadow: 0 1px 6px rgba(0,0,0,.08);
    }
    .add { min-width: 84px; }
    .meta { margin: 10px 0 14px; color: #666; font-size: 12px; }
    .list { display: flex; flex-direction: column; gap: 10px; }
    .card {
      border: 1px solid #eee; border-radius: 14px; padding: 12px;
      box-shadow: 0 1px 10px rgba(0,0,0,.06);
    }
    .cardTop { display: flex; justify-content: space-between; align-items: center; gap: 10px; }
    .date { color: #777; font-size: 12px; white-space: nowrap; }
    .del { font-size: 12px; }
    .text { margin-top: 8px; white-space: pre-wrap; line-height: 1.35; }
    .empty { color: #888; font-size: 14px; padding: 14px 4px; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>üìù Î©îÎ™®</h1>

    <div class="row">
      <textarea id="input" placeholder="Î©îÎ™®Î•º ÏûÖÎ†•ÌïòÍ≥† Ï∂îÍ∞Ä Î≤ÑÌäºÏùÑ ÎàÑÎ•¥ÏÑ∏Ïöî. (Ctrl+EnterÎ°úÎèÑ Ï∂îÍ∞Ä)"></textarea>
      <button class="add" id="addBtn">Ï∂îÍ∞Ä</button>
    </div>

    <div class="meta" id="meta"></div>
    <div class="list" id="list"></div>
  </div>

  <script>
    const $input = document.getElementById("input");
    const $addBtn = document.getElementById("addBtn");
    const $list = document.getElementById("list");
    const $meta = document.getElementById("meta");

    function fmt(iso) {
      try {
        const d = new Date(iso);
        return d.toLocaleString();
      } catch {
        return iso;
      }
    }

    function render(memos) {
      $meta.textContent = `Ï¥ù ${memos.length}Í∞ú (Î°úÏª¨ Ï†ÄÏû•Îê®)`;
      $list.innerHTML = "";

      if (memos.length === 0) {
        const div = document.createElement("div");
        div.className = "empty";
        div.textContent = "ÏïÑÏßÅ Î©îÎ™®Í∞Ä ÏóÜÏäµÎãàÎã§.";
        $list.appendChild(div);
        return;
      }

      for (const m of memos) {
        const card = document.createElement("div");
        card.className = "card";

        const top = document.createElement("div");
        top.className = "cardTop";

        const date = document.createElement("div");
        date.className = "date";
        date.textContent = fmt(m.createdAt);

        const del = document.createElement("button");
        del.className = "del";
        del.textContent = "ÏÇ≠Ï†ú";
        del.addEventListener("click", async () => {
          const next = await window.memoAPI.delete(m.id);
          render(next);
        });

        top.appendChild(date);
        top.appendChild(del);

        const text = document.createElement("div");
        text.className = "text";
        text.textContent = m.text;

        card.appendChild(top);
        card.appendChild(text);

        $list.appendChild(card);
      }
    }

    async function refresh() {
      const memos = await window.memoAPI.list();
      render(memos);
    }

    async function addMemo() {
      const text = $input.value;
      const next = await window.memoAPI.add(text);
      $input.value = "";
      $input.focus();
      render(next);
    }

    $addBtn.addEventListener("click", addMemo);
    $input.addEventListener("keydown", (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key === "Enter") addMemo();
    });

    refresh();
  </script>
</body>
</html>
